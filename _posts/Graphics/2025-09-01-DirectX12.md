---
title: DirectX12 장치 초기화
date: 2025-09-01 18:08:00 +0900
categories: [Graphics, DirectX12]
tags: [DirectX12, Graphics]     # TAG names should always be lowercase
---

Microsoft DXGI(DirectX Graphics Infrastructure)는 커널 모드 드라이버 및 시스템 하드웨어와 통신하는 역할을 한다.

## 1. DXGI 생성 (SwapChain 제외)
IDXGIFactory 생성 => Adapter 열거 및 선택

## 2. Debug Layer 활성화
GPU 기반 검증 활성화, DRED (Device Removed Extended Data) 활성화

## 3. DirectX12 Device, Command Queue 생성
IDXGIAdapter를 이용하여 Device 생성 => Device를 이용하여 Command Queue 생성     
      
커맨드 큐의 경우 Description을 통해 Direct, Compute, Copy로 세 가지 엔진을 구성할 수 있고,      
세 가지 엔진을 구현하면 Asset Uploading, Compute Shader 등을 별도로 구성 가능하다.     
단일 GPU 작업인 경우 NodeMask는 0으로 세팅해야한다. 

참고 자료: [Microsoft Learn 다중 엔진 동기화](https://learn.microsoft.com/ko-kr/windows/win32/direct3d12/user-mode-heap-synchronization)

## 4. SwapChain 생성
IDXGIFactory, DirectX12 Command Queue (Direct Type), 윈도우 핸들을 이용하여 Swap Chain 생성      
Description의 Multi Sampling, Swap Effect 세팅 부분에서 생각지도 못한 실패를 경험했다.      
     
Swap Effect의 DXGI_SWAP_EFFECT_DISCARD 처음에 세팅해두었는데, 아래와 같은 경고를 만나고 최신 버전에선 Flip으로 사용한다는 사실을 알게되었다.

> DXGI WARNING: IDXGIFactory::CreateSwapChain: Blt-model swap effects (DXGI_SWAP_EFFECT_DISCARD and DXGI_SWAP_EFFECT_SEQUENTIAL) are legacy swap effects that are predominantly superceded by their flip-model counterparts (DXGI_SWAP_EFFECT_FLIP_SEQUENTIAL and
> DXGI_SWAP_EFFECT_FLIP_DISCARD). Please consider updating your application to leverage flip-model swap effects to benefit from modern presentation enhancements. More information is available at http://aka.ms/dxgiflipmodel. [ MISCELLANEOUS WARNING #294: ]

Swap Effect 관련 경고를 수정한 이후, Flip 효과를 적용하면 Multi Sampling을 지원하지 않는다는 경고를 만나게 되었다.

> DXGI ERROR: IDXGIFactory::CreateSwapChain: Flip model swapchains (DXGI_SWAP_EFFECT_FLIP_SEQUENTIAL and DXGI_SWAP_EFFECT_FLIP_DISCARD) do not support multisampling. DXGI_SWAP_CHAIN_DESC{ SwapChainType = ..._HWND, BufferDesc = DXGI_MODE_DESC1{Width = 1920, Height = 1080, RefreshRate = DXGI_RATIONAL{ Numerator = 60, Denominator = 1 }, Format = R8G8B8A8_UNORM, ScanlineOrdering = ..._UNSPECIFIED, Scaling = ..._UNSPECIFIED, Stereo = FALSE }, SampleDesc = DXGI_SAMPLE_DESC{ Count = 4, Quality = 1 }, BufferUsage = 0x20, BufferCount = 2, OutputWindow = 0x000000000CE10D0A, Scaling = ..._STRETCH, Windowed = TRUE, SwapEffect = ..._FLIP_DISCARD, AlphaMode = ..._IGNORE, Flags = 0x2 } [ MISCELLANEOUS ERROR #102: ]

현대 게임이 수많은 후처리 작업을 수행하면서 다른 FXAA, MLAA, SMAA 등도 지원해야 하기 때문에 스왑 체인에서 Multi-Sampling을 하지 못하도록 해두었다고 한다.
  - 정확하게 확인된 사실은 아닙니다. 
  - 참조 [StackOverflow Question](https://stackoverflow.com/questions/56286975/how-to-fix-this-multisampling-error-when-creating-a-swapchain)

===============================================================      
DXGIFactory CreateSwapChain 설명을 보면, DirectX 11 버전까지는 Direct3D device 포인터를 DirectX 12 버전부터는 direct command queue인 
ID3D12CommandQueue 포인터를 Parameters로 전달하여 스왑체인을 생성한다.     

### 가설
 - DirectX11 Device의 직접 실행 컨텍스트 부분이 DirectX12 부터는 CommandQueue로 분리되었음
